language:
  python

python:
  - '3.4'

env:
  global:
    - APPNAME=test-openspending
    - XUNIT_FILE=shippable/testresults/result.xml

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - pip install -r requirements.txt

script:
  - pylama authz
  - nosetests tests --with-coverage --cover-package authz --with-xunit --xunit-file shippable/testresults/nosetests.xml

after_script:
  - coverage xml -o shippable/coverage/coverage.xml

after_success:
  - git push -f git@heroku.com:${APPNAME}.git master

notifications:
  email:
    - roll@respect31.com
